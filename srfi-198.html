<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SRFI 198: Foreign Interface Error Handling</title>
    <link href="/favicon.png" rel="icon" sizes="192x192" type="image/png">
    <link rel="stylesheet" href="https://srfi.schemers.org//srfi.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1"></head>
  <body>
    <h1><a href="https://srfi.schemers.org/"><img class="srfi-logo" src="https://srfi.schemers.org/srfi-logo.svg" alt="SRFI logo" /></a>198: Foreign Interface Error Handling</h1>


<p>Authors</p>

John Cowan, Lassi Kortela, and Harold Ancell


<h2>Status</h2>


<h2>Abstract</h2>

When errors from Scheme interfaces to "foreign" systems such as the
P<small>OSIX</small> API, libraries, and databases are detected, this
SRFI provides the means to construct, return or signal, and extract
information from those errors in a reasonably uniform way.


<h2>Issues</h2>

<p>None at present.</p>


<h2>Rationale</h2>

<p>R6RS and R7RS-large have ambitions to become comprehensive
ecosystems useful for developing real world applications.  This
necessitates the development of many interfaces to "foreign" systems,
ranging from direct Foreign Function Interfaces (FFIs) to low level
assembler and C libraries, including APIs at that level such as
P<small>OSIX</small>, to protocols such as TCP/IP, all the way to
client-server systems such as databases running in their own
processes.</p>

<p>This SRFI provides a comprehensive framework for placing data about
errors from foreign systems into an object, starting with
<em>error-sets</em> to partition collections of related errors,
such as 'posix, 'postgresql, and 'libsodium, and to report them.</p>

<p>Sometimes it will make sense to simply return an error object, but
an often preferred method is to raise an exception, like
<a href="https://srfi.schemers.org/srfi-170/srfi-170.html">SRFI
170</a> in which procedures never return error codes, or use an
analogue of the P<small>OSIX</small> <code>errno</code> variable to
indicate system-call-level errors.</p>

<p>Thus procedures can return useful values, and the programmer can to
assume that if a foreign interface procedure returns, it succeeded.
This greatly simplifies the flow of the code from the programmer's
point of view.</p>


<h2>Specification</h2>

<!--
<dl>
<dt> <code>(set-errno! <i>errno</i>)</code> &nbsp;&nbsp;&nbsp;&rarr; &nbsp;&nbsp;&nbsp;<i>undefined</i> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(procedure)</dt>
<dd>
<p>Sets the current value of <code>errno</code>, where the argument <code><i>errno</i></code> is an exact integer.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">(errno) &rArr; 2
(set-errno! 0)
(errno) &rArr; 0
</pre></td></tr></table>
</dd>
</dl>
-->

<h3>Procedures</h3>

<h4>Error predicate</h4>

<dl>
<dt> <code>(foreign-error? <i>object</i>)</code> &nbsp;&nbsp;&nbsp;&rarr; &nbsp;&nbsp;&nbsp;<i>boolean</i> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(procedure)</dt>
<dd>
<p>Returns #f unless <i>obj</i> is a SRFI 198 error.</p>
<table><tr><td>&nbsp;</td><td><pre class="example">(foreign-error? "This is not an foreign-error-object") &rArr; #f
</pre></td></tr></table>
</dd>
</dl>

<h4>Error field getters</h4>

<!--<dl>
<dt> <code>(foreign-error: <i>foreign-error-object</i>)</code> &nbsp;&nbsp;&nbsp;&rarr; &nbsp;&nbsp;&nbsp;<i>alist</i> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(procedure)</dt>
<dd>
<p>
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">(foreign-error: <i>foreign-error-object</i>) &rArr; 
</pre></td></tr></table>
</dd>
</dl>
<-->

<dl>
<dt> <code>(foreign-error:error-set <i>foreign-error-object</i>)</code> &nbsp;&nbsp;&nbsp;&rarr; &nbsp;&nbsp;&nbsp;<i>symbol</i> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(procedure)</dt>
<dd>
<p>Partitions the universe of foreign errors into distinct collections based on their source.
</p>

<p>Suggests error sets:</p>

<table>
<tr><th>'errno</th> <th><a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/errno.h.html">P<small>OSIX</small> errnos</a></th></tr>
<tr><th>'libsodium</th> <th><a href="https://doc.libsodium.org/">The libsodium cryptograpghy library</a></th></tr>
<tr><th>'postgresql</th> <th><a href="https://www.postgresql.org/docs/current/errcodes-appendix.html">PostgreSQL errors</a></th></tr>
</table>

<table><tr><td>&nbsp;</td><td><pre class="example">(foreign-error: <i>foreign-error-object</i>) &rArr; 'errno
</pre></td></tr></table>
</dd>
</dl>



<h2>Implementation</h2>

A sample work in progress implementation of this SRFI can be found in
the srfi directory of its repository.


<h2>Acknowledgments</h2>

Thanks to Olin Shivers and all the Scheme implementers who have
followed his work; this SRFI was inspired by scsh's
<code>errno-error</code> facility.  Thanks also to all the
participants in the SRFI 170 and SRFI 198 mailing lists.


<h2>Copyright</h2>
<p>Copyright &copy; John Cowan, Lassi Kortela, and Harold Ancell (2020).</p>

<p>
  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:</p>

<p>
  The above copyright notice and this permission notice (including the
  next paragraph) shall be included in all copies or substantial
  portions of the Software.</p>
<p>
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT.  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.</p>

  <hr>
  <address>Editor: <a href="mailto:srfi-editors+at+srfi+dot+schemers+dot+org">Arthur A. Gleckler</a></address></body></html>
